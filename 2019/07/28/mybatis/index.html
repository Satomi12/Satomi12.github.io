<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  
  
  
  
  
  
  
  
    
  
  <link href="/css/prism/tomorrow-night/prism.css" rel="stylesheet">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-corner-indicator.min.css?v=1.0.2">















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="传统的JDBC操作数据库有许多局限性，比如说硬编码，数据库连接管理麻烦，sql代码和java代码耦合，手动释放资源等，最最重要的是结果集到对象的映射需要我们手动完成。MyBatis的出现解决了这些问题。 MyBatis介绍MyBatis是apache旗下的一个开源ORM框架，源于iBatis。它的原理实际上是在底层封装了JDBC，使得我们能更专注于数据库操作。另一个方面，因为MyBatis是对JD">
<meta name="keywords" content="MyBatis">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis数据库操作">
<meta property="og:url" content="http://Satomi12.github.io/2019/07/28/mybatis/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:description" content="传统的JDBC操作数据库有许多局限性，比如说硬编码，数据库连接管理麻烦，sql代码和java代码耦合，手动释放资源等，最最重要的是结果集到对象的映射需要我们手动完成。MyBatis的出现解决了这些问题。 MyBatis介绍MyBatis是apache旗下的一个开源ORM框架，源于iBatis。它的原理实际上是在底层封装了JDBC，使得我们能更专注于数据库操作。另一个方面，因为MyBatis是对JD">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-08-03T12:16:13.217Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MyBatis数据库操作">
<meta name="twitter:description" content="传统的JDBC操作数据库有许多局限性，比如说硬编码，数据库连接管理麻烦，sql代码和java代码耦合，手动释放资源等，最最重要的是结果集到对象的映射需要我们手动完成。MyBatis的出现解决了这些问题。 MyBatis介绍MyBatis是apache旗下的一个开源ORM框架，源于iBatis。它的原理实际上是在底层封装了JDBC，使得我们能更专注于数据库操作。另一个方面，因为MyBatis是对JD">



  <link rel="alternate" href="/atom.xml" title="我的博客" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://Satomi12.github.io/2019/07/28/mybatis/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>MyBatis数据库操作 | 我的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">satomi12.github.io</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://Satomi12.github.io/2019/07/28/mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tao">
      <meta itemprop="description" content="This is a new blog!">
      <meta itemprop="image" content="/images/Breloom.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MyBatis数据库操作

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-28 16:32:58" itemprop="dateCreated datePublished" datetime="2019-07-28T16:32:58+08:00">2019-07-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-03 20:16:13" itemprop="dateModified" datetime="2019-08-03T20:16:13+08:00">2019-08-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">评论数：</span>
                <a href="/2019/07/28/mybatis/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/07/28/mybatis/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-file"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>传统的JDBC操作数据库有许多局限性，比如说硬编码，数据库连接管理麻烦，sql代码和java代码耦合，手动释放资源等，最最重要的是结果集到对象的映射需要我们手动完成。MyBatis的出现解决了这些问题。</p>
<h2 id="MyBatis介绍"><a href="#MyBatis介绍" class="headerlink" title="MyBatis介绍"></a>MyBatis介绍</h2><p>MyBatis是apache旗下的一个开源ORM框架，源于iBatis。它的原理实际上是在底层封装了JDBC，使得我们能更专注于数据库操作。另一个方面，因为MyBatis是对JDBC的封装，因此从效率的角度上来讲，JDBC &gt; Mybatis，不过这点代价是值得的。</p>
<h2 id="MyBatis配置文件"><a href="#MyBatis配置文件" class="headerlink" title="MyBatis配置文件"></a>MyBatis配置文件</h2><p>来看一下一般的mybatis配置文件是怎么样的：</p>
<pre class="lang-xml" data-line="31"><code>
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
    &lt;!--配置信息，也可以从文件中读取--&gt;
    &lt;properties&gt;&lt;/properties&gt;

    &lt;!--设置，例如开启驼峰匹配和缓存等--&gt;
    &lt;settings&gt;&lt;/settings&gt;

    &lt;!--为全路径类名设置别名等--&gt;
    &lt;typeAliases&gt;&lt;/typeAliases&gt;

    &lt;!--环境，可以配置多个--&gt;
    &lt;environments default="development"&gt;
        &lt;environment id="test"&gt;
            &lt;!--事务管理器，这里是JDBC类型--&gt;
            &lt;transactionManager type="JDBC" /&gt;
            &lt;!--数据源--&gt;
            &lt;dataSource type="POOLED"&gt;&lt;/dataSource&gt;
        &lt;/environment&gt;

        &lt;environment id="development"&gt;
            &lt;transactionManager type="JDBC" /&gt;
            &lt;dataSource type="POOLED"&gt;&lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;!--sql查询包含在mapper中--&gt;
    &lt;mappers&gt;&lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>

<p>这里并未对每个标签进行具体配置，旨在看清mybatis全局配置文件的结构。这里最重要的是第31行，指定了配置sql语句的mapper的位置，在后面将会看到这一点。</p>
<a id="more"></a>
<h2 id="一个具体的例子"><a href="#一个具体的例子" class="headerlink" title="一个具体的例子"></a>一个具体的例子</h2><p>假设数据库中有一张User表，用于存放User的各项信息，接下来看看mybatis是怎么将该表中的记录映射到内存中的对象的。</p>
<p>首先在pom.xml中增加依赖：</p>
<pre class="lang-xml"><code>
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.16&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3 id="创建tb-user表"><a href="#创建tb-user表" class="headerlink" title="创建tb_user表"></a>创建tb_user表</h3><pre class="lang-sql"><code>
CREATE TABLE tb_user (
    id int NOT NULL AUTO_INCREMENT,
    user_name varchar(32) DEFAULT NULL,
    password varchar(32) DEFAULT NULL,
    name varchar(32) DEFAULT NULL,
    age int DEFAULT NULL,
    sex int DEFAULT NULL,
    birthday date DEFAULT NULL,
    created datetime DEFAULT NULL,
    updated datetime DEFAULT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;
</code></pre>

<p>插入两条数据：</p>
<pre class="lang-sql"><code>
INSERT INTO tb_user(user_name, password, name, age, sex, birthday, created, updated)
VALUES("Garchomp", "garchomp12345", "tao", 20, 0, "1996-10-01", now(), now());

INSERT INTO tb_user(user_name, password, name, age, sex, birthday, created, updated)
VALUES("Breloom", "Breloom12345", "chen", 20, 0, "1996-10-02", now(), now());
</code></pre>

<h3 id="创建pojo类"><a href="#创建pojo类" class="headerlink" title="创建pojo类"></a>创建pojo类</h3><p>创建一个pojo类User用以映射tb_user表中的记录：</p>
<pre class="lang-java"><code>
package com.pokehunter.pojo;

import java.io.Serializable;
import java.text.SimpleDateFormat;
import java.util.Date;

public class User implements Serializable {
    private Integer id;
    private String userName;
    private String password;
    private String name;
    private Integer age;
    private Integer sex;
    private Date birthday;
    private String created;
    private String updated;

    //省略了getter和setter方法

    @Override
    public String toString() {
        return "User{ " +
                "id = " + id + ", " +
                "userName = " + userName + ", " +
                "password = " + password + ", " +
                "name = " + name + ", " +
                "age = " + age + ", " +
                "sex = " + sex + ", " +
                "birthday = " + new SimpleDateFormat("yyyy-MM-dd").format(birthday) + ", " +
                "created = " + created + ", " +
                "updated = " + updated + " }";
    }
}
</code></pre>

<h3 id="创建UserDao接口"><a href="#创建UserDao接口" class="headerlink" title="创建UserDao接口"></a>创建UserDao接口</h3><pre class="lang-java"><code>
package com.pokehunter.dao;

import com.pokehunter.pojo.User;

import java.util.List;

public interface UserDao {
    User queryUserById(int id);

    List&lt;User&gt; queryUserAll();

    void insertUser(User user);

    void updateUser(User user);

    void deleteUser(int id);
}
</code></pre>

<h3 id="创建UserDaoMapper-xml"><a href="#创建UserDaoMapper-xml" class="headerlink" title="创建UserDaoMapper.xml"></a>创建UserDaoMapper.xml</h3><p>最关键的就是mapper的创建，因为具体sql语句就是在mapper中配置的。</p>
<pre class="lang-xml"><code>
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;

&lt;!--当采用接口的动态代理时namespace应当与接口的全路径名一致--&gt;
&lt;mapper namespace="com.pokehunter.dao.UserDao"&gt;
    &lt;!--注意这里id应当与接口中的方法名一致，当设置了别名时resultType可以不用全路径名--&gt;
    &lt;!--设置了typeAlias因此可以直接用别名--&gt;
    &lt;select id="queryUserById" resultType="User"&gt;
        SELECT * FROM tb_user WHERE id = #{id}
    &lt;/select&gt;

    &lt;select id="queryUserAll" resultType="com.pokehunter.pojo.User"&gt;
        SELECT * FROM tb_user
    &lt;/select&gt;

    &lt;insert id="insertUser" parameterType="com.pokehunter.pojo.User"&gt;
        INSERT INTO tb_user(user_name, password, name, age, sex, birthday, created, updated)
        VALUES (#{userName}, #{password}, #{name}, #{age}, #{sex}, #{birthday}, now(), now())
    &lt;/insert&gt;

    &lt;update id="updateUser" parameterType="com.pokehunter.pojo.User"&gt;
        UPDATE tb_user
        &lt;!--suffixOverrides表示如果最后有多余的该符号时就会删去--&gt;
        &lt;trim prefix="set" suffixOverrides=","&gt;
            &lt;if test="userName != null"&gt;user_name = #{userName},&lt;/if&gt;
            &lt;if test="password != null"&gt;password = #{password},&lt;/if&gt;
            &lt;if test="name != null"&gt;name = #{name},&lt;/if&gt;
            &lt;if test="age != null"&gt;age = #{age},&lt;/if&gt;
            &lt;if test="sex != null"&gt;sex = #{sex},&lt;/if&gt;
            &lt;if test="birthday != null"&gt;birthday = #{birthday},&lt;/if&gt;
            updated = now(),
        &lt;/trim&gt;
        WHERE id = #{id}
    &lt;/update&gt;

    &lt;delete id="deleteUser"&gt;
        DELETE FROM tb_user WHERE id = #{id}
    &lt;/delete&gt;
&lt;/mapper&gt;
</code></pre>

<h3 id="修改mybatis-config-xml"><a href="#修改mybatis-config-xml" class="headerlink" title="修改mybatis-config.xml"></a>修改mybatis-config.xml</h3><pre class="lang-xml"><code>
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;

&lt;configuration&gt;
    &lt;properties&gt;
        &lt;property name="driver" value="com.mysql.cj.jdbc.Driver" /&gt;
        &lt;property name="url" value="jdbc:mysql:///ssm" /&gt;
        &lt;property name="username" value="tao" /&gt;
        &lt;property name="password" value="qwe12345" /&gt;
    &lt;/properties&gt;

    &lt;settings&gt;
        &lt;setting name="mapUnderscoreToCamelCase" value="true"/&gt;
    &lt;/settings&gt;

    &lt;typeAliases&gt;
        &lt;typeAlias type="com.pokehunter.pojo.User" alias="User" /&gt;
    &lt;/typeAliases&gt;

    &lt;environments default="development"&gt;
        &lt;environment id="test"&gt;
            &lt;transactionManager type="JDBC" /&gt;
            &lt;dataSource type="POOLED"&gt;
                &lt;property name="driver" value="com.mysql.cj.jdbc.Driver" /&gt;
                &lt;property name="url" value="jdbc:mysql:///ssm" /&gt;
                &lt;property name="username" value="tao" /&gt;
                &lt;property name="password" value="qwe12345" /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;

        &lt;environment id="development"&gt;
            &lt;transactionManager type="JDBC" /&gt;
            &lt;dataSource type="POOLED"&gt;
                &lt;property name="driver" value="${driver}" /&gt;
                &lt;property name="url" value="${url}" /&gt;
                &lt;property name="username" value="${username}" /&gt;
                &lt;property name="password" value="${password}" /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;mappers&gt;
        &lt;mapper resource="mappers/UserDaoMapper.xml" /&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>

<h3 id="添加log4j日志"><a href="#添加log4j日志" class="headerlink" title="添加log4j日志"></a>添加log4j日志</h3><p>为了能更清晰地观察运行过程，有必要引入log4j依赖：</p>
<pre class="lang-xml"><code>
&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
    &lt;version&gt;2.0.0-alpha0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>添加log4j.properties:</p>
<pre class="lang-properties"><code>
log4j.rootLogger=DEBUG,A1
log4j.logger.org.apache=DEBUG
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%-d{yyyy-MM-dd HH:mm:ss,SSS} [%t] [%c]-[%p] %m%n
</code></pre>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>引入junit依赖：</p>
<pre class="lang-xml"><code>
&lt;dependency&gt;
    &lt;groupId&gt;junit&lt;/groupId&gt;    
    &lt;artifactId&gt;junit&lt;/artifactId&gt;
    &lt;version&gt;4.13-beta-3&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>

<p>编写UserDaoTest.java:</p>
<pre class="lang-java"><code>
package com.pokehunter.dao;

import com.pokehunter.pojo.User;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
import org.junit.Before;
import org.junit.Test;

import java.io.InputStream;
import java.util.Date;
import java.util.List;

public class UserDaoTest {
    private UserDao userDao;
    private SqlSession sqlSession;

    @Before
    public void setUp() throws Exception {
        //加载mybatis配置文件
        String resource = "mybatis-config.xml";
        InputStream inputStream = Resources.getResourceAsStream(resource);
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        this.sqlSession = sqlSessionFactory.openSession();
        this.userDao = sqlSession.getMapper(UserDao.class);
    }

    @Test
    public void queryUserById() {
        User user = userDao.queryUserById(1);
        System.out.println(user);
    }

    @Test
    public void queryUserAll() {
        List&lt;User&gt; users = userDao.queryUserAll();
        for (User user : users) {
            System.out.println(user);
        }
    }

    @Test
    public void insertUser() {
        User user = new User();
        user.setId(4);
        user.setUserName("Li");
        user.setPassword("54321");
        user.setName("Cross");
        user.setBirthday(new Date("1994/10/10"));
        user.setAge(20);
        user.setSex(0);
        userDao.insertUser(user);
        sqlSession.commit();
    }

    @Test
    public void updateUser() {
        User user = new User();
        user.setId(1);
        user.setUserName("Lei");
        user.setName("Zeni");
        userDao.updateUser(user);
        sqlSession.commit();
    }

    @Test
    public void deleteUser() {
        userDao.deleteUser(4);
        sqlSession.commit();
    }
}
</code></pre>

<p>首先运行queryUserById()，结果如下：</p>
<pre class="lang-none"><code>
2019-07-28 20:54:07,695 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-28 20:54:08,115 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-28 20:54:08,115 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-28 20:54:08,119 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-28 20:54:08,152 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 1(Integer)
2019-07-28 20:54:08,177 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
User{ id = 1, userName = Garchomp, password = garchomp12345, name = tao, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:01:15 }
</code></pre>

<p>运行insertUser()之后运行queryUserAll()，如下可见有3条记录了：</p>
<pre class="lang-none"><code>
2019-07-28 20:57:19,762 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-28 20:57:20,195 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 285133380.
2019-07-28 20:57:20,195 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10feca44]
2019-07-28 20:57:20,199 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==>  Preparing: SELECT * from tb_user 
2019-07-28 20:57:20,230 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==> Parameters: 
2019-07-28 20:57:20,260 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] &lt;==      Total: 3
User{ id = 1, userName = Garchomp, password = garchomp12345, name = tao, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:01:15 }
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
User{ id = 4, userName = Li, password = 54321, name = Cross, age = 20, sex = 0, birthday = 1994-10-09, created = 2019-07-28 20:55:20, updated = 2019-07-28 20:55:20 }
</code></pre>

<p>然后是updateUser():</p>
<pre class="lang-none"><code>
2019-07-28 20:58:38,718 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-28 20:58:39,147 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 285133380.
2019-07-28 20:58:39,147 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10feca44]
2019-07-28 20:58:39,151 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==>  Preparing: SELECT * from tb_user 
2019-07-28 20:58:39,183 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==> Parameters: 
2019-07-28 20:58:39,212 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] &lt;==      Total: 3
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
User{ id = 4, userName = Li, password = 54321, name = Cross, age = 20, sex = 0, birthday = 1994-10-09, created = 2019-07-28 20:55:20, updated = 2019-07-28 20:55:20 }
</code></pre>

<p>最后测试一下删除id=4的记录，接着执行queryUserAll()：</p>
<pre class="lang-none"><code>
2019-07-28 21:00:57,768 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-28 21:00:58,200 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 285133380.
2019-07-28 21:00:58,200 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10feca44]
2019-07-28 21:00:58,205 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==>  Preparing: SELECT * from tb_user 
2019-07-28 21:00:58,237 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==> Parameters: 
2019-07-28 21:00:58,268 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] &lt;==      Total: 2
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
</code></pre>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>User类就像一个容器，用于和表打交道，当要存储该容器中的内容时，就从中取出然后作为一条记录放进表中；当要读取时，就从表中把查询得到的信息放入容器中。这两者之间的映射就是mybatis完成的工作，UserDao接口定义了存取User的方式，UserMapperDao.xml则实现具体的存取操作。动态代理的机制使得我们仅根据接口定义的方法就可以完成具体的数据存取，而无需手动创建类去实现该接口。不过有一点要注意，<strong>使用基于接口的动态代理时，mapper的namespace一定要等于接口的全路径名。</strong></p>
<h2 id="数据库字段名和类属性名不一致"><a href="#数据库字段名和类属性名不一致" class="headerlink" title="数据库字段名和类属性名不一致"></a>数据库字段名和类属性名不一致</h2><p>在上个例子之中，表中的有个字段是user_name，而User类中对应该字段的属性为userName，两者名字不一样，如何完成映射的呢？查看mybatis-config.xml，玄机在于下面这句：</p>
<pre class="lang-xml"><code>
&lt;setting name="mapUnderscoreToCamelCase" value="true"/&gt;
</code></pre>

<p>该设置表示自动将有下划线的字符串映射为符合驼峰命名规范的名字，mybatis的具体做法为：去掉下划线，将所有单词拼接在一起，从第二个单词起首字母大写。事实上，映射时字符串是大小写不敏感的，也就是说去掉下划线拼接单词后，字段名和属性名将按照大小写不敏感的方式进行匹配。</p>
<p>当然这种方法有局限性，当字段名和类属性名就是完全不一样时，就没辙了。因此有时需要采用以下两种方法：</p>
<ul>
<li>在mapper中sql语句的查询操作中使用别名，将查询出的表字段名设置别名等于类属性名。</li>
<li>使用resultMap，这个将在之后介绍。</li>
</ul>
<h2 id="和"><a href="#和" class="headerlink" title="${}和#{}"></a>${}和#{}</h2><p>两者都表示向sql传递参数，但是不同的是${}是直接拼接字符串，相当于Statement的处理；#{}则是先将参数加引号再去替换，相当于PreparedStatement，可以防止sql注入。</p>
<h2 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h2><p>有些时候，我们需要根据输入的具体的值来构造sql语句，以下有几个常用的标签。</p>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>假设需要根据输入的name来查找User信息，如果输入为空则输出所有User信息。</p>
<p>定义接口：</p>
<pre class="lang-java"><code>
List&lt;User&gt; queryUserList(@Param("name") String name);
</code></pre>

<p>编写mapper：</p>
<pre class="lang-xml"><code>
&lt;select id="queryUserList" resultType="User"&gt;
    SELECT * FROM tb_user WHERE 1=1
    &lt;if test="name != null and name.trim() != null"&gt;
        AND name LIKE '%${name}%'
    &lt;/if&gt;
&lt;/select&gt;
</code></pre>

<h3 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose when otherwise"></a>choose when otherwise</h3><p>这几个标签相当于if，else if，else的关系。<br>假设输入的name不为空则按name查找，否则如果age不为空则按age查找，两者都为空的话就查找name=”Zeni”的User。</p>
<p>定义接口：</p>
<pre class="lang-java"><code>
List&lt;User&gt; queryUserListByNameOrAge(@Param("name") String name, @Param("age") Integer age);
</code></pre>

<p>编写mapper：</p>
<pre class="lang-xml"><code>
&lt;select id="queryUserListByNameOrAge" resultType="User"&gt;
    SELECT * FROM tb_user WHERE 1=1
    &lt;choose&gt;
        &lt;when test="name != null and name.trim() != ''"&gt;
            AND name LIKE '%${name}%'
        &lt;/when&gt;
        &lt;when test="age != null"&gt;
            AND age = ${age}
        &lt;/when&gt;
        &lt;otherwise&gt;
            AND name = 'Zeni'
        &lt;/otherwise&gt;
    &lt;/choose&gt;
&lt;/select&gt;
</code></pre>

<h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>假设输入了name就按name查找，输入了age就按age查找，两者全输入则两者都要满足，若两者皆为空则输出所有User。</p>
<p>定义接口：</p>
<pre class="lang-java"><code>
List&lt;User&gt; queryUserListByNameAndAge(@Param("name") String name, @Param("age") Integer age);
</code></pre>

<p>编写mapper：</p>
<pre class="lang-xml"><code>
&lt;select id="queryUserListByNameAndAge" resultType="User"&gt;
    SELECT * FROM tb_user
    &lt;where&gt;
        &lt;if test="name != null and name.trim() != ''"&gt;
            AND name LIKE '%${name}%'
        &lt;/if&gt;
        &lt;if test="age != null"&gt;
            AND age = #{age}
        &lt;/if&gt;
    &lt;/where&gt;
&lt;/select&gt;
</code></pre>

<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p>假设需要根据一组id查找User信息。</p>
<p>定义接口：</p>
<pre class="lang-java"><code>
List&lt;User&gt; queryUserListByIds(@Param("ids") int[] ids);
</code></pre>

<p>编写mapper：</p>
<pre class="lang-xml"><code>
&lt;select id="queryUserListByIds" resultType="User"&gt;
    SELECT * FROM tb_user WHERE id in
    &lt;foreach collection="ids" item="id" open="(" close=")" separator=","&gt;
        ${id}
    &lt;/foreach&gt;
&lt;/select&gt;
</code></pre>

<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>mybatis一共有两级缓存。</p>
<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><p>mybatis的一级缓存的作用域是Session，当openSession()后，如果执行相同的sql而且参数一致时，将直接从缓存中命中返回，而不会去操作数据库。而且一级缓存是默认开启的，并且无法关闭。</p>
<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void queryUserById() {
    System.out.println(userDao.queryUserById(1));
    System.out.println(userDao.queryUserById(1));
}
</code></pre>

<p>运行结果：</p>
<pre class="lang-none"><code>
2019-07-29 13:12:11,810 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 13:12:12,260 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 13:12:12,260 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 13:12:12,265 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 13:12:12,299 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 1(Integer)
2019-07-29 13:12:12,324 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
</code></pre>

<p>另外，可以使用sqlSession.clearCache强制清除缓存：</p>
<pre class="lang-java"><code>
@Test
public void queryUserById() {
    System.out.println(userDao.queryUserById(1));
    this.sqlSession.clearCache();
    System.out.println(userDao.queryUserById(1));
}
</code></pre>

<pre class="lang-xml"><code>
2019-07-29 13:39:08,298 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 13:39:08,722 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 13:39:08,723 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 13:39:08,726 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 13:39:08,756 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 1(Integer)
2019-07-29 13:39:08,779 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
2019-07-29 13:39:08,782 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 13:39:08,782 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 1(Integer)
2019-07-29 13:39:08,784 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
</code></pre>

<h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><p>二级缓存的作用域是一个namespace，二级缓存开启时，即使Session关闭后再打开，同一个namespace中的查询仍然可以从缓存中命中。有一点要注意，<strong>使用二级缓存必须序列化</strong>。</p>
<p>开启二级缓存：</p>
<pre class="lang-xml"><code>
&lt;mapper namespace="com.pokehunter.dao.UserDao"&gt;
    &lt;cache /&gt;
&lt;/mapper&gt;
</code></pre>

<p>开启二级缓存必须使用序列化：</p>
<pre class="lang-java"><code>
public class User implements Serializable {
    private static final long serialVersionUID = -8313173113713913L;
}
</code></pre>

<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void testCache() {
    System.out.println(this.userDao.queryUserById(1));

    this.sqlSession.close();
    this.sqlSession = this.sqlSessionFactory.openSession();
    this.userDao = this.sqlSession.getMapper(UserDao.class);

    System.out.println(this.userDao.queryUserById(1));
}
</code></pre>

<p>运行日志：</p>
<pre class="lang-xml"><code>
2019-07-29 13:30:47,240 [main] [com.pokehunter.dao.UserDao]-[DEBUG] Cache Hit Ratio [com.pokehunter.dao.UserDao]: 0.0
2019-07-29 13:30:47,246 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 13:30:47,693 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 282265585.
2019-07-29 13:30:47,693 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10d307f1]
2019-07-29 13:30:47,697 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 13:30:47,728 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 1(Integer)
2019-07-29 13:30:47,755 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
2019-07-29 13:30:47,762 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10d307f1]
2019-07-29 13:30:47,762 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@10d307f1]
2019-07-29 13:30:47,762 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Returned connection 282265585 to pool.
2019-07-29 13:30:47,765 [main] [com.pokehunter.dao.UserDao]-[DEBUG] Cache Hit Ratio [com.pokehunter.dao.UserDao]: 0.5
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
</code></pre>

<p>要关闭二级缓存时要么在mapper中不开启，要么在全局mybatis配置文件中(这里关闭的话mapper中开启也没用)关闭：</p>
<pre class="lang-xml"><code>
&lt;setting name="cacheEnabled" value="false"/&gt;
</code></pre>

<h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><p>在之前的例子中，User类中的属性都不含有自定义类类型，假如类中有自定义类类型该怎么映射呢？</p>
<h3 id="表关系说明"><a href="#表关系说明" class="headerlink" title="表关系说明"></a>表关系说明</h3><p>在这里引入几张表：tb_order，表示订单；tb_orderdetail，订单详情，表示每一项商品的购买情况；tb_item，表示商品信息。</p>
<pre class="lang-sql"><code>
CREATE TABLE tb_order (
    id int NOT NULL AUTO_INCREMENT,
    user_id int DEFAULT NULL,
    order_number varchar(255) DEFAULT NULL,
    created datetime DEFAULT NULL,
    updated datetime DEFAULT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;
INSERT INTO tb_order VALUES (1, 2, '20190111141', '2019-07-01 19:38:35', '2019-07-01 19:38:40');

CREATE TABLE tb_item (
    id int NOT NULL,
    itemName varchar(255) DEFAULT NULL,
    itemPrice decimal(10,2) DEFAULT NULL,
    itemDetail varchar(255) DEFAULT NULL,
    PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
INSERT INTO tb_item VALUES (1, 'Sweater', '99.00', 'On sale!');
INSERT INTO tb_item VALUES (2, 'Jeans', '129.00', 'New!');

CREATE TABLE tb_orderdetail (
    detail_id int NOT NULL AUTO_INCREMENT,
    order_id int DEFAULT NULL,
    total_price decimal(10,0) DEFAULT NULL,
    item_id int DEFAULT NULL,
    status int(10) unsigned zerofill DEFAULT NULL,
    PRIMARY KEY (detail_id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;
INSERT INTO tb_orderdetail VALUES (1, 1, '10000', 1, '0000000001');
INSERT INTO tb_orderdetail VALUES (2, 1, '2000',  2, '0000000000');
</code></pre>

<p>创建Order类，假设Order类中有一个属性User：</p>
<pre class="lang-java"><code>
package com.pokehunter.pojo;

import java.util.Date;
import java.util.List;

public class Order {
    private Integer id;
    private Long userId;
    private String orderNumber;
    private Date created;
    private Date updated;
    private User user;

    // 省略了getter和setter方法

    @Override
    public String toString() {
        return id + " " + userId + " " + orderNumber + " " + created + " " + updated
                + " " + user + " " + detailList;
    }
}
</code></pre>

<h3 id="一对一查询"><a href="#一对一查询" class="headerlink" title="一对一查询"></a>一对一查询</h3><p>首先新建OrderMapper接口</p>
<pre class="lang-java"><code>
package com.pokehunter.dao;

import com.pokehunter.pojo.Order;
import org.apache.ibatis.annotations.Param;

public interface OrderMapper {
    Order queryOrderWithUserByOrderNumber(@Param("number") String number);
}
</code></pre>

<p>配置OrderMapper.xml</p>
<pre class="lang-xml"><code>
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.pokehunter.dao.OrderMapper"&gt;
    &lt;!--resultMap映射Order对象与结果集--&gt;
    &lt;resultMap id="orderUser" type="com.pokehunter.pojo.Order" autoMapping="true"&gt;
        &lt;id column="id" property="id" /&gt;
        &lt;association property="user" javaType="User" autoMapping="true"&gt;
            &lt;id column="user_id" property="id" /&gt;
        &lt;/association&gt;
    &lt;/resultMap&gt;

    &lt;select id="queryOrderWithUserByOrderNumber" resultMap="orderUser"&gt;
        SELECT * FROM tb_order o LEFT JOIN tb_user u ON o.user_id = u.id
        WHERE o.order_number = #{number}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>

<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void queryOrderUserByOrderNumber() {
    Order order = orderMapper.queryOrderWithUserByOrderNumber("20190111141");
    System.out.println(order.getUser());
}
</code></pre>

<pre class="lang-none"><code>
2019-07-29 15:03:43,687 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 15:03:44,107 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 15:03:44,107 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 15:03:44,112 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserByOrderNumber]-[DEBUG] ==>  Preparing: SELECT * FROM tb_order o LEFT JOIN tb_user u ON o.user_id = u.id WHERE o.order_number = ? 
2019-07-29 15:03:44,145 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserByOrderNumber]-[DEBUG] ==> Parameters: 20190111141(String)
2019-07-29 15:03:44,176 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserByOrderNumber]-[DEBUG] &lt;==      Total: 1
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-01 19:38:35, updated = 2019-07-01 19:38:40 }
</code></pre>

<h3 id="一对多查询"><a href="#一对多查询" class="headerlink" title="一对多查询"></a>一对多查询</h3><p>查询订单，查询出下单人信息以及订单详情。</p>
<p>先在Order类中加入相应属性：</p>
<pre class="lang-java" data-line="8"><code>
public class Order {
    private Integer id;
    private Long userId;
    private String orderNumber;
    private Date created;
    private Date updated;
    private User user;
    private List&lt;OrderDetail&gt; detailList;

    //省略了getter和setter
}
</code></pre>

<p>创建OrderDetail类</p>
<pre class="lang-java"><code>
public class OrderDetail {
    private Integer id;
    private Integer orderId;
    private Double totalPrice;
    private Integer status;

    //省略了getter和setter

    @Override
    public String toString() {
        return id + " " + orderId + " " + totalPrice + " " + status;
    }
}
</code></pre>

<p>接口：</p>
<pre class="lang-java"><code>
Order queryOrderWithUserAndDetailByOrderNumber(@Param("number") String number);
</code></pre>

<p>配置OrderMapper：</p>
<pre class="lang-xml"><code>
&lt;!--resultMap可以继承--&gt;
&lt;resultMap id="detail" type="com.pokehunter.pojo.Order" autoMapping="true" extends="orderUser"&gt;
    &lt;collection property="detailList" javaType="List" ofType="OrderDetail" autoMapping="true"&gt;
        &lt;id column="detail_id" property="id" /&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;

&lt;select id="queryOrderWithUserAndDetailByOrderNumber" resultMap="detail"&gt;
    SELECT * FROM tb_order o
    LEFT JOIN tb_user u ON o.user_id=u.id
    LEFT JOIN tb_orderdetail od ON o.id=od.order_id
    WHERE o.order_number = #{number}
&lt;/select&gt;
</code></pre>

<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void queryOrderWithUserAndDetailByOrderNumber() {
    Order order = orderMapper.queryOrderWithUserAndDetailByOrderNumber("20190111141");
    System.out.println(order.getUser());
    System.out.println(order.getDetailList());
}
</code></pre>

<pre class="lang-none"><code>
2019-07-29 16:33:46,549 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 16:33:46,988 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 16:33:46,988 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 16:33:46,992 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserAndDetailByOrderNumber]-[DEBUG] ==>  Preparing: select * from tb_order o left join tb_user u on o.user_id=u.id left join tb_orderdetail od on o.id=od.order_id where o.order_number = ? 
2019-07-29 16:33:47,025 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserAndDetailByOrderNumber]-[DEBUG] ==> Parameters: 20190111141(String)
2019-07-29 16:33:47,052 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserAndDetailByOrderNumber]-[DEBUG] &lt;==      Total: 2
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-01 19:38:35, updated = 2019-07-01 19:38:40 }
[1 1 10000.0 1, 2 1 2000.0 0]
</code></pre>

<h3 id="多对多查询"><a href="#多对多查询" class="headerlink" title="多对多查询"></a>多对多查询</h3><p>查询订单，查询出下单人信息以及订单详情和订单详情中的商品信息。</p>
<p>首先创建Item类：</p>
<pre class="lang-java"><code>
package com.pokehunter.pojo;

public class Item {
    private Integer id;
    private String itemName;
    private Double itemPrice;
    private String itemDetail;

    //省略了getter和setter

    @Override
    public String toString() {
        return id + " " + itemName + " " + itemPrice + " " + itemDetail;
    }
}
</code></pre>

<p>然后修改OrderDetail类：</p>
<pre class="lang-java" data-line="8, 14"><code>
package com.pokehunter.pojo;

public class OrderDetail {
    private Integer id;
    private Integer orderId;
    private Double totalPrice;
    private Integer status;
    private Item item;

    //省略了getter和setter方法

    @Override
    public String toString() {
        return id + " " + orderId + " " + totalPrice + " " + status + " { " + item + " }";
    }
}
</code></pre>

<p>定义接口：</p>
<pre class="lang-java"><code>
Order queryOrderWithUserAndDetailItemByOrderNumber(@Param("number") String number);
</code></pre>

<p>配置OrderMapper：</p>
<pre class="lang-xml"><code>
&lt;resultMap id="item" type="Order" autoMapping="true" extends="orderUser"&gt;
    &lt;collection property="detailList" javaType="List" ofType="OrderDetail" autoMapping="true"&gt;
        &lt;id column="detail_id" property="id" /&gt;
        &lt;association property="item" javaType="Item" autoMapping="true"&gt;
            &lt;id column="item_id" property="id" /&gt;
        &lt;/association&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;

&lt;select id="queryOrderWithUserAndDetailItemByOrderNumber" resultMap="item"&gt;
    SELECT * FROM tb_order o
    LEFT JOIN tb_user u ON o.user_id=u.id
    LEFT JOIN tb_orderdetail od ON o.id=od.order_id
    LEFT JOIN tb_item i ON od.item_id=i.id
    &lt;!--小于号需要转义--&gt;
    WHERE o.order_number = #{number} AND od.status &lt;![CDATA[ &lt;= ]]&gt; 1
&lt;/select&gt;
</code></pre>

<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void queryOrderWithUserAndDetailItemByOrderNumber() {
    Order order = orderMapper.queryOrderWithUserAndDetailItemByOrderNumber("20190111141");
    System.out.println(order.getUser());
    System.out.println(order.getDetailList());
}
</code></pre>

<pre class="lang-xml"><code>
2019-07-29 17:07:14,022 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 17:07:14,472 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 17:07:14,473 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 17:07:14,477 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserAndDetailItemByOrderNumber]-[DEBUG] ==>  Preparing: select * from tb_order o left join tb_user u on o.user_id=u.id left join tb_orderdetail od on o.id=od.order_id left join tb_item i on od.item_id=i.id where o.order_number = ? AND od.status <= 1 2019-07-29 17:07:14,513 [main] [com.pokehunter.dao.ordermapper.queryorderwithuseranddetailitembyordernumber]-[debug]="="> Parameters: 20190111141(String)
2019-07-29 17:07:14,546 [main] [com.pokehunter.dao.OrderMapper.queryOrderWithUserAndDetailItemByOrderNumber]-[DEBUG] &lt;==      Total: 2
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-01 19:38:35, updated = 2019-07-01 19:38:40 }
[1 1 10000.0 1 { 1 Sweater 99.0 On sale! }, 2 1 2000.0 0 { 2 Jeans 129.0 New! }]
</=></code></pre>

<h2 id="不同表字段名相同的解决办法"><a href="#不同表字段名相同的解决办法" class="headerlink" title="不同表字段名相同的解决办法"></a>不同表字段名相同的解决办法</h2><p>在进行连接查询的时候，有可能两张表的某个字段同名，这个时候mybatis的处理方式是：前面的字段覆盖后面的，也就是说如果结果集中有两个相同的字段名（比如id），则只有结果集中靠前的一个会被映射，另一个则被覆盖。</p>
<p>如果两个字段含义相同或者我们只需要映射前一个字段，那可以不用管；但是如果需要映射第二个字段，这个时候就需要在sql查询语句中采用取别名的方式使得结果集中不含有同名的字段，然后用resultMap手动指定映射。</p>
<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><p>延迟加载可以推迟关联查询的执行时间，只在需要的时候进行查询。<br>与延迟加载相关的设置：</p>
<pre class="lang-xml"><code>
&lt;setting name="lazyLoadingEnabled" value="true" /&gt;
&lt;setting name="aggressiveLazyLoading" value="false" /&gt;
</code></pre>

<ol>
<li>lazyLoadingEnabled为延迟加载开关，默认为true</li>
<li>aggressiveLazyLoading启用时会直接加载所有懒对象属性，关闭时按需加载对象属性，默认为true</li>
</ol>
<p>接口定义：</p>
<pre class="lang-java"><code>
Order queryOrderAndUserByOrderNumberLazy(@Param("number") String number);
</code></pre>

<p>配置OrderMapper：</p>
<pre class="lang-xml"><code>
&lt;resultMap id="lazy" type="Order" autoMapping="true"&gt;
    &lt;id column="id" property="id" /&gt;
    &lt;!--select指定子查询，column指定子查询所需条件--&gt;
    &lt;association property="user" javaType="User" select="sub" column="user_id" /&gt;
&lt;/resultMap&gt;

&lt;select id="sub" resultType="User"&gt;
    SELECT * FROM tb_user WHERE id = #{id}
&lt;/select&gt;

&lt;select id="queryOrderAndUserByOrderNumberLazy" resultMap="lazy"&gt;
    SELECT * FROM tb_order WHERE order_number = #{number}
&lt;/select&gt;
</code></pre>

<p>测试：</p>
<pre class="lang-java"><code>
@Test
public void queryOrderAndUserByOrderNumberLazy() {
    Order order = orderMapper.queryOrderAndUserByOrderNumberLazy("20190111142");
    System.out.println(order.getOrderNumber());
    System.out.println(order.getUser());
}
</code></pre>

<pre class="lang-none"><code>
2019-07-29 19:50:21,762 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 19:50:22,202 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 19:50:22,202 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 19:50:22,206 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] ==>  Preparing: SELECT * FROM tb_order WHERE order_number = ?
2019-07-29 19:50:22,237 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] ==> Parameters: 20190111141(String)
2019-07-29 19:50:22,301 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] &lt;==      Total: 1
20190111141
2019-07-29 19:50:22,303 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ?
2019-07-29 19:50:22,304 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] ==> Parameters: 2(Integer)
2019-07-29 19:50:22,307 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] &lt;==      Total: 1
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
</code></pre>

<p>打开agressiveLazyLoading：</p>
<pre class="lang-xml"><code>
&lt;setting name="aggressiveLazyLoading" value="true" /&gt;
</code></pre>

<pre class="lang-none"><code>
2019-07-29 19:49:07,752 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Opening JDBC Connection
2019-07-29 19:49:08,186 [main] [org.apache.ibatis.datasource.pooled.PooledDataSource]-[DEBUG] Created connection 726181440.
2019-07-29 19:49:08,187 [main] [org.apache.ibatis.transaction.jdbc.JdbcTransaction]-[DEBUG] Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@2b48a640]
2019-07-29 19:49:08,191 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] ==>  Preparing: SELECT * FROM tb_order WHERE order_number = ? 
2019-07-29 19:49:08,220 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] ==> Parameters: 20190111141(String)
2019-07-29 19:49:08,280 [main] [com.pokehunter.dao.OrderMapper.queryOrderAndUserByOrderNumberLazy]-[DEBUG] &lt;==      Total: 1
2019-07-29 19:49:08,282 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 19:49:08,282 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] ==> Parameters: 2(Integer)
2019-07-29 19:49:08,285 [main] [com.pokehunter.dao.OrderMapper.sub]-[DEBUG] &lt;==      Total: 1
20190111141
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
</code></pre>

<h2 id="Spring整合MyBatis"><a href="#Spring整合MyBatis" class="headerlink" title="Spring整合MyBatis"></a>Spring整合MyBatis</h2><p>尽管MyBatis已经比JDBC的操作简化了很多，但是仍然有一些瑕疵，例如SqlSessionFactory必须要我们自己手动创建，要修改的话就得去改java代码，这样显然不够灵活。利用Spring的IOC可以进一步规范数据库操作。</p>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>在pom.xml中引入依赖：</p>
<pre class="lang-xml"><code>
&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.19&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
    &lt;version&gt;2.0.2&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;5.1.8.RELEASE&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-test --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
    &lt;version&gt;5.1.8.RELEASE&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.1.8.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3 id="创建Spring配置文件"><a href="#创建Spring配置文件" class="headerlink" title="创建Spring配置文件"></a>创建Spring配置文件</h3><p>对于maven项目，在src/main/resource目录下创建applicationContext-dao.xml:</p>
<pre class="lang-xml"><code>
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context" xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.0.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
   http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd"&gt;

    &lt;!--加载配置文件--&gt;
    &lt;context:property-placeholder location="classpath:properties/db.properties" /&gt;

    &lt;!--Druid数据库连接池--&gt;
    &lt;bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource" destroy-method="close"&gt;
        &lt;property name="driverClassName" value="${jdbc.driver}" /&gt;
        &lt;property name="url" value="jdbc:mysql://${jdbc.host}:3306/${jdbc.database}" /&gt;
        &lt;property name="username" value="${jdbc.username}" /&gt;
        &lt;property name="password" value="${jdbc.password}" /&gt;
        &lt;property name="maxActive" value="${jdbc.maxActive}" /&gt;
        &lt;property name="initialSize" value="${jdbc.initialSize}" /&gt;
        &lt;property name="minIdle" value="${jdbc.minIdle}" /&gt;
        &lt;property name="maxWait" value="${jdbc.maxWait}" /&gt;
    &lt;/bean&gt;

    &lt;!--SqlSessionFactory--&gt;
    &lt;bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean"&gt;
        &lt;property name="dataSource" ref="dataSource" /&gt;
        &lt;!--mapper的位置--&gt;
        &lt;property name="mapperLocations" value="classpath:mappers/*.xml" /&gt;
        &lt;!--mybatis的其他配置，注意其中的mappers要注释掉，因为前一行已经加载了--&gt;
        &lt;property name="configLocation" value="classpath:mybatis-config.xml" /&gt;
    &lt;/bean&gt;

    &lt;!--接口的位置，指定包--&gt;
    &lt;bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt;
        &lt;property name="basePackage" value="com.pokehunter.dao" /&gt;
        &lt;property name="sqlSessionFactoryBeanName" value="sqlSessionFactory" /&gt;
    &lt;/bean&gt;

    &lt;!--事务管理--&gt;
    &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
        &lt;property name="dataSource" ref="dataSource" /&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
</code></pre>

<p>其中db.properties内容：</p>
<pre class="lang-properties"><code>
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.host=localhost
jdbc.database=ssm
jdbc.username=tao
jdbc.password=qwe12345
jdbc.initialSize=0
jdbc.maxActive=20
jdbc.minIdle=1
jdbc.maxWait=1000
</code></pre>

<p>另外有一点要注意，<strong>如果配置了mapperLocations就要把mybatis配置文件中的mappers相关代码注释掉，不然会因为重复加载报错，或者如果没有特殊设置可以选择不配置mybatis配置文件。</strong></p>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><pre class="lang-java"><code>
package com.pokehunter.dao;

import com.pokehunter.pojo.User;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.Date;
import java.util.List;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:spring/applicationContext-dao.xml")
public class UserMapperSpringTest {
    @Autowired
    private UserDao userDao;

    @Test
    public void testQueryUserById() {
        User user = this.userDao.queryUserById(2);
        System.out.println(user);

        user = new User();
        user.setId(2);
        user.setUserName("Milotic");
        user.setName("ray");
        this.userDao.updateUser(user);

        System.out.println(this.userDao.queryUserById(2));
    }

    @Test
    public void testQueryUserAll() {
        List<user> users = this.userDao.queryUserAll();
        for (User user : users) {
            System.out.println(user);
        }
    }
}
</user></code></pre>

<p>先测试queryUserAll()，由于日志太多，这里只列出关键部分：</p>
<pre class="lang-none"><code>
2019-07-29 20:58:02,806 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==>  Preparing: SELECT * from tb_user 
2019-07-29 20:58:02,830 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] ==> Parameters: 
2019-07-29 20:58:02,853 [main] [com.pokehunter.dao.UserDao.queryUserAll]-[DEBUG] &lt;==      Total: 2
2019-07-29 20:58:02,855 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@2d29b4ee]
User{ id = 1, userName = Lei, password = garchomp12345, name = Zeni, age = 20, sex = 0, birthday = 1996-10-01, created = 2019-07-28 20:01:15, updated = 2019-07-28 20:58:30 }
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
2019-07-29 20:58:02,857 [main] [org.springframework.test.context.support.AbstractDirtiesContextTestExecutionListener]-[DEBUG] After test method: context [DefaultTestContext@5ae63ade testClass = UserMapperSpringTest, testInstance = com.pokehunter.dao.UserMapperSpringTest@551aa95a, testMethod = testQueryUserAll@UserMapperSpringTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@610694f1 testClass = UserMapperSpringTest, locations = '{classpath:spring/applicationContext-dao.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]], class annotated with @DirtiesContext [false] with mode [null], method annotated with @DirtiesContext [false] with mode [null].
2019-07-29 20:58:02,858 [main] [org.springframework.test.context.support.AbstractDirtiesContextTestExecutionListener]-[DEBUG] After test class: context [DefaultTestContext@5ae63ade testClass = UserMapperSpringTest, testInstance = [null], testMethod = [null], testException = [null], mergedContextConfiguration = [MergedContextConfiguration@610694f1 testClass = UserMapperSpringTest, locations = '{classpath:spring/applicationContext-dao.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]], class annotated with @DirtiesContext [false] with mode [null].
2019-07-29 20:58:02,862 [Thread-1] [org.springframework.context.support.GenericApplicationContext]-[DEBUG] Closing org.springframework.context.support.GenericApplicationContext@396f6598, started on Mon Jul 29 20:58:01 CST 2019
2019-07-29 20:58:02,864 [Thread-1] [com.alibaba.druid.pool.DruidDataSource]-[INFO] {dataSource-1} closing ...
2019-07-29 20:58:02,868 [Thread-1] [com.alibaba.druid.pool.DruidDataSource]-[INFO] {dataSource-1} closed
</code></pre>

<p>再测试queryUserById()，这里中间还修改了记录，观察修改前后的变化：</p>
<pre class="lang-none"><code>
2019-07-29 21:07:10,219 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 21:07:10,246 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 2(Integer)
2019-07-29 21:07:10,270 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
2019-07-29 21:07:10,272 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@565f390]
User{ id = 2, userName = Breloom, password = Breloom12345, name = chen, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-28 20:01:17 }
2019-07-29 21:07:10,273 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Creating a new SqlSession
2019-07-29 21:07:10,274 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@a82c5f1] was not registered for synchronization because synchronization is not active
2019-07-29 21:07:10,292 [main] [org.springframework.jdbc.datasource.DataSourceUtils]-[DEBUG] Fetching JDBC Connection from DataSource
2019-07-29 21:07:10,292 [main] [org.mybatis.spring.transaction.SpringManagedTransaction]-[DEBUG] JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@a1f72f5] will not be managed by Spring
2019-07-29 21:07:10,293 [main] [com.pokehunter.dao.UserDao.updateUser]-[DEBUG] ==>  Preparing: UPDATE tb_user set user_name = ?, name = ?, updated = now() WHERE id = ? 
2019-07-29 21:07:10,293 [main] [com.pokehunter.dao.UserDao.updateUser]-[DEBUG] ==> Parameters: Milotic(String), ray(String), 2(Integer)
2019-07-29 21:07:10,296 [main] [com.pokehunter.dao.UserDao.updateUser]-[DEBUG] &lt;==    Updates: 1
2019-07-29 21:07:10,296 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@a82c5f1]
2019-07-29 21:07:10,296 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Creating a new SqlSession
2019-07-29 21:07:10,297 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@68f1b17f] was not registered for synchronization because synchronization is not active
2019-07-29 21:07:10,297 [main] [org.springframework.jdbc.datasource.DataSourceUtils]-[DEBUG] Fetching JDBC Connection from DataSource
2019-07-29 21:07:10,297 [main] [org.mybatis.spring.transaction.SpringManagedTransaction]-[DEBUG] JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@a1f72f5] will not be managed by Spring
2019-07-29 21:07:10,297 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==>  Preparing: SELECT * FROM tb_user WHERE id = ? 
2019-07-29 21:07:10,297 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] ==> Parameters: 2(Integer)
2019-07-29 21:07:10,299 [main] [com.pokehunter.dao.UserDao.queryUserById]-[DEBUG] &lt;==      Total: 1
2019-07-29 21:07:10,299 [main] [org.mybatis.spring.SqlSessionUtils]-[DEBUG] Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@68f1b17f]
User{ id = 2, userName = Milotic, password = Breloom12345, name = ray, age = 20, sex = 0, birthday = 1996-10-02, created = 2019-07-28 20:01:17, updated = 2019-07-29 21:07:10 }
2019-07-29 21:07:10,300 [main] [org.springframework.test.context.support.AbstractDirtiesContextTestExecutionListener]-[DEBUG] After test method: context [DefaultTestContext@5ae63ade testClass = UserMapperSpringTest, testInstance = com.pokehunter.dao.UserMapperSpringTest@551aa95a, testMethod = testQueryUserById@UserMapperSpringTest, testException = [null], mergedContextConfiguration = [MergedContextConfiguration@610694f1 testClass = UserMapperSpringTest, locations = '{classpath:spring/applicationContext-dao.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]], class annotated with @DirtiesContext [false] with mode [null], method annotated with @DirtiesContext [false] with mode [null].
2019-07-29 21:07:10,301 [main] [org.springframework.test.context.support.AbstractDirtiesContextTestExecutionListener]-[DEBUG] After test class: context [DefaultTestContext@5ae63ade testClass = UserMapperSpringTest, testInstance = [null], testMethod = [null], testException = [null], mergedContextConfiguration = [MergedContextConfiguration@610694f1 testClass = UserMapperSpringTest, locations = '{classpath:spring/applicationContext-dao.xml}', classes = '{}', contextInitializerClasses = '[]', activeProfiles = '{}', propertySourceLocations = '{}', propertySourceProperties = '{}', contextCustomizers = set[[empty]], contextLoader = 'org.springframework.test.context.support.DelegatingSmartContextLoader', parent = [null]], attributes = map[[empty]]], class annotated with @DirtiesContext [false] with mode [null].
2019-07-29 21:07:10,305 [Thread-1] [org.springframework.context.support.GenericApplicationContext]-[DEBUG] Closing org.springframework.context.support.GenericApplicationContext@396f6598, started on Mon Jul 29 21:07:09 CST 2019
2019-07-29 21:07:10,306 [Thread-1] [com.alibaba.druid.pool.DruidDataSource]-[INFO] {dataSource-1} closing ...
2019-07-29 21:07:10,311 [Thread-1] [com.alibaba.druid.pool.DruidDataSource]-[INFO] {dataSource-1} closed
</code></pre>

<hr>

      
    </div>

    

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<div class="post-copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

  <li><strong>本文标题：</strong> MyBatis数据库操作</li>
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Tao</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="http://Satomi12.github.io/2019/07/28/mybatis/" title="MyBatis数据库操作">http://Satomi12.github.io/2019/07/28/mybatis/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://Satomi12.github.io/2019/07/28/mybatis/" aria-label="复制成功！"></i></span>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</div>
<script>
  var clipboard = new Clipboard('.fa-clipboard');
  $(".fa-clipboard").click(function(){
    clipboard.on('success', function(){
      swal({
        title: "",
        text: '复制成功',
        icon: "success",
        showConfirmButton: true
        });
  });
  });
</script>

      </div>
    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/MyBatis/" rel="tag"><i class="fa fa-tag"></i> MyBatis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/22/serialize/" rel="next" title="Java序列化">
                <i class="fa fa-chevron-left"></i> Java序列化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/03/SSM/" rel="prev" title="Spring+SpringMVC+Mybatis整合">
                Spring+SpringMVC+Mybatis整合 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/Breloom.png" alt="Tao">
            
              <p class="site-author-name" itemprop="name">Tao</p>
              <div class="site-description motion-element" itemprop="description">This is a new blog!</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Satomi12" title="GitHub &rarr; https://github.com/Satomi12" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:licdftl@gmail.com" title="E-Mail &rarr; mailto:licdftl@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://plus.google.com/licdftl" title="Google &rarr; https://plus.google.com/licdftl" rel="noopener" target="_blank"><i class="fa fa-fw fa-google"></i>Google</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://stackoverflow.com/users/11588968/satomi" title="StackOverflow &rarr; https://stackoverflow.com/users/11588968/satomi" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://space.bilibili.com/5514163" title="https://space.bilibili.com/5514163" rel="noopener" target="_blank">Bilibili</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://bookfere.com" title="https://bookfere.com" rel="noopener" target="_blank">Bookfere</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis介绍"><span class="nav-number">1.</span> <span class="nav-text">MyBatis介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis配置文件"><span class="nav-number">2.</span> <span class="nav-text">MyBatis配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个具体的例子"><span class="nav-number">3.</span> <span class="nav-text">一个具体的例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建tb-user表"><span class="nav-number">3.1.</span> <span class="nav-text">创建tb_user表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建pojo类"><span class="nav-number">3.2.</span> <span class="nav-text">创建pojo类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建UserDao接口"><span class="nav-number">3.3.</span> <span class="nav-text">创建UserDao接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建UserDaoMapper-xml"><span class="nav-number">3.4.</span> <span class="nav-text">创建UserDaoMapper.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改mybatis-config-xml"><span class="nav-number">3.5.</span> <span class="nav-text">修改mybatis-config.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加log4j日志"><span class="nav-number">3.6.</span> <span class="nav-text">添加log4j日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试"><span class="nav-number">3.7.</span> <span class="nav-text">测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">3.8.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库字段名和类属性名不一致"><span class="nav-number">4.</span> <span class="nav-text">数据库字段名和类属性名不一致</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#和"><span class="nav-number">5.</span> <span class="nav-text">${}和#{}</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态sql"><span class="nav-number">6.</span> <span class="nav-text">动态sql</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if"><span class="nav-number">6.1.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#choose-when-otherwise"><span class="nav-number">6.2.</span> <span class="nav-text">choose when otherwise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#where"><span class="nav-number">6.3.</span> <span class="nav-text">where</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#foreach"><span class="nav-number">6.4.</span> <span class="nav-text">foreach</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存"><span class="nav-number">7.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一级缓存"><span class="nav-number">7.1.</span> <span class="nav-text">一级缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二级缓存"><span class="nav-number">7.2.</span> <span class="nav-text">二级缓存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级查询"><span class="nav-number">8.</span> <span class="nav-text">高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#表关系说明"><span class="nav-number">8.1.</span> <span class="nav-text">表关系说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对一查询"><span class="nav-number">8.2.</span> <span class="nav-text">一对一查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一对多查询"><span class="nav-number">8.3.</span> <span class="nav-text">一对多查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多对多查询"><span class="nav-number">8.4.</span> <span class="nav-text">多对多查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不同表字段名相同的解决办法"><span class="nav-number">9.</span> <span class="nav-text">不同表字段名相同的解决办法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延迟加载"><span class="nav-number">10.</span> <span class="nav-text">延迟加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring整合MyBatis"><span class="nav-number">11.</span> <span class="nav-text">Spring整合MyBatis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#引入依赖"><span class="nav-number">11.1.</span> <span class="nav-text">引入依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建Spring配置文件"><span class="nav-number">11.2.</span> <span class="nav-text">创建Spring配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试-1"><span class="nav-number">11.3.</span> <span class="nav-text">测试</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tao</span>

  

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  











  
  
  <script id="ribbon" size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>





  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/affix.js?v=7.1.2"></script>

  <script src="/js/schemes/pisces.js?v=7.1.2"></script>




  
  <script src="/js/scrollspy.js?v=7.1.2"></script>
<script src="/js/post-details.js?v=7.1.2"></script>



  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  
  
  

  

  
  
  


  
  

<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'VOdOGk924tHlsAb7lcCCHOcP-gzGzoHsz',
    appKey: '1EPrNDsAqllBkh08EW7Xqvbz',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn'
  });
</script>




  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  
  
  
  <script src="/lib/pangu/dist/pangu.min.js?v=3.3"></script>
  <script>pangu.spacingPage();</script>


  

  

  

  

  
  
  
  
  
  
  
  
  
    
  
  <script src="/js/prism/tomorrow-night/prism.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
